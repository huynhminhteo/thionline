var table_user,table_user_element=".table-user";$((function(){"use strict";loadTableUser(),$(window).keydown((function(e){if(13==e.keyCode)return e.preventDefault(),!1})),$(document).on("click","#btnRegist",(function(){refreshModalRegist(),$("#modal_regist").modal("show")})),$(document).on("click","#table_user tbody tr",(function(){var e=$(this).data("id"),t=$(this).data("name"),a=$(this).data("role"),r=$(this).data("mail");e&&(refreshModalUpdate(),$("#modal_update #id_user").val(e),$("#modal_update #update_name").val(t),$("#modal_update #update_role").val(a).trigger("change"),$("#modal_update #text_mail").html(r),1==e||operator_login_id==e?($("#modal_update #btnDelete").addClass("d-none"),$("#text_role").html(1==a?"管理者":"一般")):$("#modal_update #update_role").val(a).trigger("change"),$("#modal_update").modal("show"))})),$(document).on("click","#modal_update #btnDelete",(function(e){e.preventDefault(),Swal.fire({text:"ユーザーを削除しますがよろしいでしょうか",showCancelButton:!0,cancelButtonText:"いいえ",confirmButtonText:"はい"}).then((function(e){void 0===e.dismiss&&(run_waitMe(".wait-containter"),$.ajax({url:base_api+"/user/delete/v1?token="+_token,type:"POST",data:{id:$("#modal_update #id_user").val(),mail:$("#modal_update #text_mail").text()},success:function(e){run_waitMe(".wait-containter",!0),Swal.fire({text:e.msg}).then((function(){run_waitMe(".wait-containter"),window.location.replace(base_url+"/user")}))},error:function(e){run_waitMe(".wait-containter",!0),Swal.fire({text:e.responseJSON.msg})}}))}))})),$(document).on("click","#modal_update #btnChange",(function(e){e.preventDefault();var t=$("#form_update");t.parsley().validate(),t.parsley().isValid()&&(run_waitMe(".wait-containter"),$.ajax({url:base_api+"/user/update/v1?token="+_token,type:"POST",data:$("#form_update").serialize(),success:function(e){run_waitMe(".wait-containter",!0),Swal.fire({text:e.msg}).then((function(){run_waitMe(".wait-containter"),window.location.replace(base_url+"/user")}))},error:function(e){run_waitMe(".wait-containter",!0),Swal.fire({text:e.responseJSON.msg})}}))})),$(document).on("submit","#form_regist",(function(e){e.preventDefault(),run_waitMe(".wait-containter"),$.ajax({url:base_api+"/user/operator/add/v1?token="+_token,type:"POST",data:$("#form_regist").serialize(),success:function(e){run_waitMe(".wait-containter",!0),Swal.fire({text:e.msg}).then((function(){run_waitMe(".wait-containter"),window.location.replace(base_url+"/user")}))},error:function(e){run_waitMe(".wait-containter",!0),Swal.fire({text:e.responseJSON.msg})}})}))}));var loadTableUser=function(){run_waitMe(".wait-containter"),$.fn.DataTable.isDataTable(table_user_element)&&($(table_user_element).DataTable().destroy(),$(".table-user tbody").empty());var e=base_api+"/user/v1?token="+_token;table_user=$(table_user_element).DataTable({scrollY:"70vh",scrollCollapse:!0,stateSave:!0,autoWidth:!1,processing:!0,ajax:e,searching:!1,bSort:!1,bLengthChange:!1,bInfo:!1,bFilter:!1,bPaginate:!1,language:{emptyTable:"テーブル内のデータなし",zeroRecords:"一致する検索結果がありません"},columns:[{data:"name"},{data:"role",render:function(e,t,a){return 1==e?"管理者":"一般"}},{data:"mail"}],columnDefs:[{targets:[0,1,2],class:"text-center multi-line"}],initComplete:function(e,t){$(".slim-body .slim-mainpanel .container").addClass("d-block"),run_waitMe(".wait-containter",!0)},fnCreatedRow:function(e,t,a){$(e).attr("data-id",t.id),$(e).attr("data-name",t.name),$(e).attr("data-role",t.role),$(e).attr("data-mail",t.mail)}}).on("processing.dt",(function(e,t,a){a?run_waitMe(".wait-containter"):($(".slim-body .slim-mainpanel .container").addClass("d-block"),run_waitMe(".wait-containter",!0))})),$(".dataTables_scrollHead").hide()},refreshModalRegist=function(){$("#form_regist #regist_name").val(""),$("#form_regist #regist_mail").val(""),$("#form_regist #regist_role").val(null).trigger("change"),$("#form_regist").parsley().reset()},refreshModalUpdate=function(){$("#form_update #update_name").val(""),$("#form_update #text_mail").html(""),$("#form_update #btnDelete").removeClass("d-none"),$("#text_role").empty(),$("#text_role").append('<div id="slWrapperRoleUpdate" class="parsley-select">        <select class="form-control select2 role" style="width: 100%" id="update_role" name="role"                data-placeholder="選択してください" data-parsley-trigger-after-failure="focusout"                data-parsley-class-handler="#slWrapperRoleUpdate"                data-parsley-errors-container="#slErrorContainerRoleUpdate" required                data-parsley-required-message="必須項目です">            <option label="Select Role"></option>            <option value="1">管理者</option>            <option value="2">一般</option>        </select>        <div id="slErrorContainerRoleUpdate"></div>    </div>'),$(".role").select2({minimumResultsForSearch:1/0}),$("#form_update #update_role").val(null).trigger("change"),$("#form_update").parsley().reset()};