var table_contract_status_medical,table_contract_status_element=".table-contract-status-medical",companyId=$("#id").val();$((function(){"use strict";getInfoCompany(),$('a[data-toggle="tab"]').on("shown.bs.tab",(function(a){switch(a.target.id){case"info-tab":$("#btnUse").removeClass("d-none"),$(".slim-pageheader").removeClass("mg-t-15"),$(".slim-body .slim-mainpanel .container").removeClass("d-block"),getInfoCompany();break;case"status-tab":$("#btnUse").addClass("d-none"),$(".slim-pageheader").addClass("mg-t-15"),$(".slim-body .slim-mainpanel .container").removeClass("d-block"),loadTableContractStatus()}})),$(document).on("click","#btnUse",(function(a){a.preventDefault();var t=$(this).data("type");Swal.fire({text:" un_use "==t?"利用停止してもよろしいですか？":"利用再開してもよろしいですか？",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#aaa",cancelButtonText:"いいえ",confirmButtonText:"はい",customClass:"swal-wide"}).then((function(a){void 0===a.dismiss&&(run_waitMe(".wait-containter"),$.ajax({url:base_api+"/contract/company/use/v1?token="+_token,type:"POST",data:{companyId:companyId,type:t},success:function(a){run_waitMe(".wait-containter",!0),Swal.fire({text:a.msg}).then((function(){run_waitMe(".wait-containter"),window.location.reload()}))},error:function(a){run_waitMe(".wait-containter",!0),Swal.fire({text:a.responseJSON.msg})}}))}))})),$(document).on("click",".export-bill",(function(a){a.preventDefault();var t=$(this).data("id"),n=$(this).data("company"),e=$(this).data("office"),o=$(this).data("date");exportBill(t,n,e,o)})),$(document).on("click",".export-receipt",(function(a){a.preventDefault();var t=$(this).data("id"),n=$(this).data("company"),e=$(this).data("office"),o=$(this).data("date");exportReceipt(t,n,e,o)}))}));var getInfoCompany=function(){run_waitMe(".wait-containter"),$.ajax({url:base_api+"/contract/detail/company/v1?token="+_token,type:"POST",data:{companyId:companyId},success:function(a){var t=a.data,n=moment(t.contract_date),e=!!t.cancel_contract_date&&moment(t.cancel_contract_date);$("#form_info #corp_id").val(t.corp_id),$("#form_info #company_name").val(t.name),$("#form_info #company_name_kana").val(t.name_kana),$("#form_info #company_name_kana").val(t.name_kana),$("#form_info #office_name").val(t.office_name),$("#form_info #office_name_kana").val(t.office_name_kana),$("#form_info #postal_code").val(t.post_code),$("#form_info #address").val(t.address),$("#form_info #building").val(t.building),$("#form_info #phone").val(t.phone),$("#form_info #fax").val(t.fax),$("#form_info #charge").val(t.account_manager_name),$("#form_info #email").val(t.mail),$("#start_contract").html(moment(n).format("YYYY年MM月DD日")),e?($("#end_contract").html(moment(e).format("YYYY年MM月DD日")),$(".label-end-contract").removeClass("d-none")):($("#end_contract").html(""),$(".label-end-contract").addClass("d-none")),$(".slim-body .slim-mainpanel .container").addClass("d-block"),run_waitMe(".wait-containter",!0)},error:function(a){run_waitMe(".wait-containter",!0),Swal.fire({text:a.responseJSON.msg})}})},loadTableContractStatus=function(){run_waitMe(".wait-containter"),$.fn.DataTable.isDataTable(table_contract_status_element)&&($(table_contract_status_element).DataTable().destroy(),$(".table-contract-status-medical tbody").empty()),table_contract_status_medical=$(table_contract_status_element).DataTable({stateSave:!0,autoWidth:!1,processing:!1,ajax:base_api+"/contract/detail/contract/v1?companyId="+companyId+"&token="+_token,searching:!1,bSort:!1,pagingType:"numbers",dom:"<rt>",language:{zeroRecords:"一致する検索結果がありません",emptyTable:"テーブル内のデータなし"},responsive:!0,columns:[{data:null,render:function(a,t,n){return moment().year(a.contract_year).month(a.contract_month-1).format("YYYY年MM月")}},{data:"mPlan.name"},{data:"mPlan.amount",render:function(a,t,n){return 1==n.is_trial?"0円":parseInt(a).toLocaleString()+"円"}},{data:"status",render:function(a,t,n){return 1==n.is_trial?"トライアル":1==a||2==a?"入金済み":"未入金"}},{render:function(a,t,n){var e=moment().year(n.contract_year).month(n.contract_month-1).format("YYYYMM");return'<a class="btn btn-light rounded-7 btn-cus-hm font-bold export-bill"                                data-id="'+n.id+'" data-company="'+n.mCompany.name+'" data-office="'+n.mCompany.office_name+'" data-date="'+e+'">                                    請求書発行                            </a>'}},{data:"status",render:function(a,t,n){var e=moment().year(n.contract_year).month(n.contract_month-1).format("YYYYMM");return a?'<a class="btn btn-light rounded-7 btn-cus-hm font-bold export-receipt"                                        data-id="'+n.id+'" data-company="'+n.mCompany.name+'" data-office="'+n.mCompany.office_name+'" data-date="'+e+'">                                            領収書発行                                    </a>':""}}],columnDefs:[{targets:[0,1,2,3,4,5],class:"text-center"}],initComplete:function(a,t){$(".slim-body .slim-mainpanel .container").addClass("d-block"),run_waitMe(".wait-containter",!0)},fnCreatedRow:function(a,t,n){$(a).attr("data-id",t.id)}}).on("processing.dt",(function(a,t,n){n?run_waitMe(".wait-containter"):($(".slim-body .slim-mainpanel .container").addClass("d-block"),run_waitMe(".wait-containter",!0))}))},exportBill=function(a,t,n,e){run_waitMe(".wait-containter"),$.ajax({type:"POST",url:base_api+"/contract/detail/export-bill/v1",data:{token:_token,id:a},xhrFields:{responseType:"blob"},success:function(a,o,i){var c=(null!=t?t+"_":"")+(null!=n?n+"_":"")+e+"請求書";if(void 0!==window.navigator.msSaveBlob)window.navigator.msSaveBlob(a,c);else{var r=window.URL||window.webkitURL,l=r.createObjectURL(a);if(c){var d=document.createElement("a");void 0===d.download?window.location.href=l:(d.href=l,d.download=c,document.body.appendChild(d),d.click())}else window.location.href=l;setTimeout((function(){run_waitMe(".wait-containter",!0),r.revokeObjectURL(l)}),100)}}})},exportReceipt=function(a,t,n,e){run_waitMe(".wait-containter"),$.ajax({type:"POST",url:base_api+"/contract/detail/export-receipt/v1",data:{token:_token,id:a},xhrFields:{responseType:"blob"},success:function(a,o,i){var c=(null!=t?t+"_":"")+(null!=n?n+"_":"")+e+"領収書";if(void 0!==window.navigator.msSaveBlob)window.navigator.msSaveBlob(a,c);else{var r=window.URL||window.webkitURL,l=r.createObjectURL(a);if(c){var d=document.createElement("a");void 0===d.download?window.location.href=l:(d.href=l,d.download=c,document.body.appendChild(d),d.click())}else window.location.href=l;setTimeout((function(){run_waitMe(".wait-containter",!0),r.revokeObjectURL(l)}),100)}}})};