var table_contract_medical,url_get_datatables=base_api+"/contract/all/v1?token="+_token,url_detail_contract=base_url+"/contract/detail/",table_contract_element=".table-contract-medical",filter_text="",filter_plan="",filter_payment="",filter_status="under",length_contract="15";$((function(){"use strict";loadTableContract(),loadEventFilter(),$(window).keydown((function(t){if(13==t.keyCode)return t.preventDefault(),!1})),$(document).on("click","#table_contract_medical tbody tr",(function(){var t=$(this).attr("data-id");t&&(run_waitMe(".wait-containter"),window.location.href=url_detail_contract+t)}))}));var loadTableContract=function(){run_waitMe(".wait-containter"),$.fn.DataTable.isDataTable(table_contract_element)&&($(table_contract_element).DataTable().destroy(),$(".table-contract-medical tbody").empty());var t=url_get_datatables;t+="&filter_text="+$("#filter_text").val(),filter_plan&&""!=filter_plan&&(t+="&filter_plan="+filter_plan),filter_payment&&""!=filter_payment&&(t+="&filter_payment="+filter_payment),filter_status&&""!=filter_status&&(t+="&filter_status="+filter_status),(table_contract_medical=$(table_contract_element).DataTable({pageLength:length_contract,autoWidth:!1,serverSide:!0,ajax:t,searching:!1,bSort:!1,pagingType:"numbers",dom:'<"d-flex justify-content-end flex-column flex-sm-row align-items-end align-items-sm-start"<"mr-0 mr-sm-2 mb-2 mb-sm-0"i>l>rt<p>',language:{paginate:{first:"最初",previous:"前",next:"次",last:"最終"},lengthMenu:"_MENU_",emptyTable:"テーブル内のデータなし",info:"検索結果／_TOTAL_件",infoEmpty:"",infoFiltered:"",zeroRecords:"一致する検索結果がありません"},lengthMenu:[[15,50,100],["15件表示","50件表示","100件表示"]],sLengthSelect:"select2",responsive:!0,columns:[{data:"id",searchable:!1},{data:"mCompany.corp_id"},{data:"mCompany.name"},{data:"mCompany.office_name"},{data:"status_contract",searchable:!1},{data:"mPlan.name",searchable:!1},{data:"mPlan.amount",render:function(t,a,e){return 1==e.is_trial?"0円":parseInt(t).toLocaleString()+"円"},searchable:!1},{data:"status_charge",searchable:!1}],columnDefs:[{targets:[0,1,4,5,6,7],class:"text-center"},{targets:[2,3],class:"multi-line"}],initComplete:function(t,a){$(".dataTables_length select").val(length_contract).trigger("change.select2"),$(".slim-body .slim-mainpanel .container").addClass("d-block"),run_waitMe(".wait-containter",!0)},fnCreatedRow:function(t,a,e){$(t).attr("data-id",a.company_id)}}).on("processing.dt",(function(t,a,e){e?run_waitMe(".wait-containter"):($(".slim-body .slim-mainpanel .container").addClass("d-block"),run_waitMe(".wait-containter",!0))})).on("draw.dt",(function(){var t=$(this).DataTable().page.info();table_contract_medical.column(0,{page:"current"}).nodes().each((function(a,e){a.innerHTML=e+1+t.start}))}))).clear().draw(),$(".dataTables_length select").length>0&&$(".dataTables_length select").select2({minimumResultsForSearch:1/0,dropdownCssClass:"z-index-900"}).on("select2:select",(function(t){length_contract=$(this).val(),changePageLength(".table-contract-medical",table_contract_medical,length_contract)}))},loadEventFilter=function(){$.ajax({url:base_api+"/contract/plans/v1?token="+_token,type:"GET",success:function(t){if(t.data){var a=t.data;$(".filter-plans").empty(),a.forEach((function(t,a){$(".filter-plans").append('                        <div class="col-12 col-sm-4 mt-2 mt-sm-0">                            <button class="btn btn-light rounded-7 btn-cus-hm btn-search-plan font-bold" data-search="'+t.id+'" type="button">                                '+t.name+"                            </button>                        </div>                    "),$(".summary-plans").append('                        <span class="icon_slash">／</span>'+t.name+' : <span class="number-contract-'+t.id+'">0件</span>                    ')}))}},error:function(t){Swal.fire({text:t.responseJSON.msg})}}),$.ajax({url:base_api+"/contract/summary/v1?token="+_token,type:"GET",success:function(t){if(t.data){var a=t.data.summary,e=t.data.total;$(".number-contract").html(e+"件"),a.forEach((function(t,a){$(".number-contract-"+t.plan_id).html(t.total+"件")}))}},error:function(t){Swal.fire({text:t.responseJSON.msg})}}),$(document).on("click",".btn-search-plan",(function(){$(".btn.btn-search-plan.btn-cus-hm").removeClass("active"),$(this).addClass("active"),filter_plan=$(this).attr("data-search"),loadTableContract()})),$(document).on("click",".btn-search-payment",(function(){$(".btn.btn-search-payment.btn-cus-hm").removeClass("active"),$(this).addClass("active"),filter_payment=$(this).attr("data-search"),loadTableContract()})),$(document).on("click",".btn-search-status",(function(){$(".btn.btn-search-status.btn-cus-hm").removeClass("active"),$(this).addClass("active"),filter_status=$(this).attr("data-search"),loadTableContract()})),$(document).on("keypress","#filter_text",(function(t){"13"==(t.keyCode?t.keyCode:t.which)&&(filter_text=$("#filter_text").val(),loadTableContract())})),$(document).on("click","#filter_text_btn",(function(){filter_text=$("#filter_text").val(),loadTableContract()})),$(document).on("click","#btn_search_all",(function(){$(".btn.btn-search-plan.btn-cus-hm").removeClass("active"),$(".btn.btn-search-payment.btn-cus-hm").removeClass("active"),$(".btn.btn-search-status.btn-cus-hm").removeClass("active"),$("#filter_text").val(""),filter_plan="",filter_payment="",filter_status="",filter_text="",loadTableContract()}))};